import numpy as np
import matplotlib.pyplot as plt


def file_size(file):
    import os
    filesize = os.stat(file)
    filesize_in_kb = filesize.st_size / 1000
    return filesize_in_kb


def get_width(filesize):
    if filesize < 10:
        width = 32
    elif 10 <= filesize < 30:
        width = 64
    elif 30 <= filesize < 60:
        width = 128
    elif 60 <= filesize < 100:
        width = 256
    elif 100 <= filesize < 200:
        width = 384
    elif 200 <= filesize < 500:
        width = 512
    elif 500 <= filesize < 1000:
        width = 768
    else:
        width = 1024
    return width


def convert_exe_to_image(file, save_path):
    """

    :param file: exe file
    :param save_path: folder where to save images, eg:C:/images/
    :return: image in grayscale
    """
    names = file.split('/')
    filename = names[-1]
    filesize = file_size(file)
    width = get_width(filesize)
    f = open(file, 'r+b')
    alist = []
    for each in f:
        for item in each:
            alist.append(item)
    myarray = np.asarray(alist)
    length = myarray.shape
    height = length[0] // width
    myarray = myarray[:height * width]
    img = np.reshape(myarray, (height, width))
    plt.gray()
    plt.imshow(img)
    plt.savefig(save_path + filename + '.jpg')
